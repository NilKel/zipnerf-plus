# Sphere Positional Encoder Testing Configuration
# This config tests F_ENCODER vs P_ENCODER on the analytical sphere dataset

# Base configuration
Config.exp_name = 'sphere_positional_test'
Config.dataset_loader = 'blender'
Config.data_dir = '../data/nerf_synthetic/sphere_analytical'

# Camera and scene settings
Config.near = 2.0
Config.far = 6.0
Config.factor = 4  # Downsample to 200x200 for faster testing
Config.use_tiffs = False
Config.eval_only_once = False
Config.eval_quantize_metrics = True
Config.eval_crop_borders = 8

# POSITIONAL ENCODER CONFIGURATION
# This is where we enable positional encoders instead of grid encoders
# Switch between F_ENCODER and P_ENCODER using use_potential flag

# Enable positional encoder for both NerfMLP and PropMLP
NerfMLP.use_positional_encoder = True
NerfMLP.pos_enc_num_freqs = 10
NerfMLP.pos_enc_log_sampling = True
NerfMLP.feature_mlp_hidden_dim = 64
NerfMLP.feature_mlp_num_layers = 2

PropMLP.use_positional_encoder = True
PropMLP.pos_enc_num_freqs = 10
PropMLP.pos_enc_log_sampling = True
PropMLP.feature_mlp_hidden_dim = 64
PropMLP.feature_mlp_num_layers = 2

# Confidence field configuration (required for positional encoders)
Config.use_potential = True  # Set to True for P_ENCODER, False for F_ENCODER
Config.confidence_grid_resolution = (128, 128, 128)
Config.confidence_reg_mult = 0.0

# Use the sigmoid probability grids (non-binary, frozen)
Config.debug_confidence_grid_path = 'sphere_confidence_probabilities/sphere_confidence_probs_128.pt'
Config.freeze_debug_confidence = True
Config.binary_occupancy = False  # Use smooth sigmoid occupancy
Config.analytical_gradient = True  # Use analytical gradients for better accuracy

# Training settings - fast testing
Config.max_steps = 3000
Config.lr_init = 0.02
Config.lr_final = 0.002
Config.lr_delay_steps = 500
Config.batch_size = 4096
Config.checkpoint_every = 1000

# Model configuration - simplified for testing
Model.raydist_fn = None
Model.num_prop_samples = 32
Model.num_nerf_samples = 16
Model.num_levels = 2  # 1 proposal + 1 nerf level

# MLP settings - disable density normals for speed
PropMLP.disable_density_normals = True
PropMLP.disable_rgb = True
PropMLP.grid_level_dim = 1  # Not used with positional encoder

NerfMLP.disable_density_normals = True
NerfMLP.grid_level_dim = 1  # Not used with positional encoder

# Loss configuration
Config.data_loss_type = 'mse'  # Use MSE for cleaner gradients with analytical data
Config.data_loss_mult = 1.0
Config.hash_decay_mults = 0  # No hash grids, so no decay needed

# Logging and evaluation
Config.print_every = 100
Config.train_render_every = 500
Config.use_wandb = True
Config.wandb_project = "zipnerf-positional-encoders"
Config.wandb_name = "sphere_positional_test"
Config.wandb_tags = ['sphere', 'positional_encoder', 'analytical_dataset']
Config.wandb_notes = 'Testing F_ENCODER vs P_ENCODER on analytical sphere dataset' 